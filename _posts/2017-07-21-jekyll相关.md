---
layout: post
title:  "使用jekyll遇到的问题"
header-img: "img/post-bg-js-module.jpg"
date:   2017-07-21 19:21:32
category: coding
tags: ruby jekyll
---

## 背景

试图为 jekyll 增加 PWA 特性支持，顺便整理了下自己之前放在 github 上的博客。
在此记录下过程中遇到的一些问题。

## bundler

我们都知道 ruby 中安装依赖的工具是 gem，类似 Node.js 中的 npm。但 gem 并没有类似 package.json 这样的依赖描述文件，这就导致安装特定版本号的依赖很不方便。

而 bundler 提供了缺失的依赖管理功能。主要依靠两个描述文件：
* `Gemfile`类似`package.json`，包含依赖列表，版本要求等。
* 安装所有依赖后会生成`Gemfile.lock`，类似 yarn 中的`yarn.lock`，存储依赖的精确版本。

这样将这两个文件连同项目一并提交，就能保证代码共享后依赖的一致性。

首先使用 gem 安装，然后创建`Gemfile`文件，写入依赖并安装：
{% highlight bash %}
gem install bundler
bundle init
echo 'gem "rspec"' >> Gemfile
bundle install
bundle exec rspec
{% endhighlight %}

## github pages

提交到指定分支(master/gh-pages)，自动完成构建，但是和本地构建不同的是，github 会加上`--save`参数，只运行[信任的插件](https://pages.github.com/versions/)。所以如果使用了其他插件，只能提交构建后的产物了。

### jekyll-seo-tag 插件

我试用了一下[jekyll-seo-tag 插件](https://github.com/jekyll/jekyll-seo-tag/)，它会从`_config.yml`中提取字段，生成机器可读的元数据，供搜索引擎和社交工具使用。

字段包括：
* title，页面标题加上站点名称
* `<meta name=description>` 目测是取内容第一段
* Canonical URL 标准格式
* [JSON-LD](https://developers.google.com/structured-data/)格式的站点数据，供搜索引擎使用
* [Open Graph](http://ogp.me/)数据，供社交工具使用

## 已有的支持 PWA 模版

我找到了一个基于 yeoman 的[模版](https://github.com/nirgn975/generator-jekyll-starter-kit)，包含了对 PWA 的支持。

主要是使用 gulp 在构建时调用 sw-precache 生成`service-worker.js`。缓存`_site`文件夹内全部静态资源。

## 后续思路

以模版而非插件形式输出，参考 pjax 思路，使用 ajax 请求页面，替换内容。配合 sw-toolbox 缓存异步请求。


