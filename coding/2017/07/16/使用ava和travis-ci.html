<!DOCTYPE html>
<html>

    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="coding编程javascriptxiaoiverxiaop">
    <meta name="theme-color" content="#eee">
    <!-- Begin Jekyll SEO tag v2.2.3 -->
<title>使用ava和travis-ci | xiaOp的博客</title>
<meta property="og:title" content="使用ava和travis-ci" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="最近给 skeleton 插件加上了测试用例，顺便使用了下自动集成工具。" />
<meta property="og:description" content="最近给 skeleton 插件加上了测试用例，顺便使用了下自动集成工具。" />
<link rel="canonical" href="http://localhost:4000/coding/2017/07/16/%E4%BD%BF%E7%94%A8ava%E5%92%8Ctravis-ci.html" />
<meta property="og:url" content="http://localhost:4000/coding/2017/07/16/%E4%BD%BF%E7%94%A8ava%E5%92%8Ctravis-ci.html" />
<meta property="og:site_name" content="xiaOp的博客" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-07-17T03:21:32+08:00" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"使用ava和travis-ci","datePublished":"2017-07-17T03:21:32+08:00","dateModified":"2017-07-17T03:21:32+08:00","description":"最近给 skeleton 插件加上了测试用例，顺便使用了下自动集成工具。","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/coding/2017/07/16/%E4%BD%BF%E7%94%A8ava%E5%92%8Ctravis-ci.html"},"url":"http://localhost:4000/coding/2017/07/16/%E4%BD%BF%E7%94%A8ava%E5%92%8Ctravis-ci.html"}</script>
<!-- End Jekyll SEO tag -->

    <title>使用ava和travis-ci</title>

    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="canonical" href="http://localhost:4000/coding/2017/07/16/%E4%BD%BF%E7%94%A8ava%E5%92%8Ctravis-ci.html">
    <link rel="manifest" href="/manifest.json">

    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-large.css" />
    <link rel="stylesheet" href="/css/highlight.css" />
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/Imager.min.js"></script>

</head>


    <body>

        <section id="header" class="skel-layers-fixed">
    <header>
        <span class="image avatar"><img src="/img/avatar.jpg" alt="" /></span>
        <h1 id="logo"><a href="/">xiaOp</a></h1>
        <p>想成为一个有趣的人</p>
    </header>
    <nav id="nav">
        <ul>
            <li><a href="#intro">主页</a></li>
            <li><a href="#blog">文章</a></li>
            <li><a href="#contact">兴趣</a></li>
        </ul>
    </nav>
    <footer>
        <ul class="icons">
            <li><a href="https://github.com/xiaoiver" class="icon fa-github"><span class="label">Github</span></a></li>
            <li><a href="mailto:pyqiverson@gmail.com" class="icon fa-envelope"><span class="label">Email</span></a></li>
            <li><a href="https://www.douban.com/people/150275082/" class="icon">豆</a></li>
            <li><a href="https://www.zhihu.com/people/pan-yu-qi-20/activities" class="icon">知</a></li>
        </ul>
    </footer>
</section>


        <div id="wrapper">
            <div id="main">
                <style type="text/css">
    header.intro-header {
        position: relative;
        background-image: url('/img/travis-ci.jpg')
    }
    
    header.intro-header .header-mask {
        width: 100%;
        height: 100%;
        position: absolute;
        background: rgba(0,0,0, 0.4);
    }
    

    .post-heading {
        position: relative;
        padding: 50px 0;
        color: white;
    }
    .post-heading h2,
    .post-heading h3,
    .post-heading h4 {
        color: white;
    }
    .post-heading h2 {
        font-size: 3em;
    }

    article {
        padding-top: 20px;
    }

    .post-container img {
        display: block;
        max-width: 100%;
        height: auto;
        margin: 1.5em auto 1.6em auto;
    }
    .post-container a {
        color: #4acaa8;
    }
</style>

<header class="intro-header" >
    <div class="header-mask"></div>
    <div class="container">
        <div class="post-heading">
            <h2>使用ava和travis-ci</h1>
            <h3 class="subheading"></h2>
            <div class="tags">
                
                <a class="tag" href="/tags#ava" title="ava">ava</a>
                
                <a class="tag" href="/tags#travis" title="travis">travis</a>
                
            </div>
            <span class="meta">Posted by xiaOp的博客 on July 16, 2017</span>
        </div>
    </div>
</header>

<article class="post-container">
    <div class="container">
        <p>最近给 <a href="https://github.com/lavas-project/vue-skeleton-webpack-plugin">skeleton 插件</a>加上了测试用例，顺便使用了下自动集成工具。</p>

<h2 id="ava"><a href="https://github.com/avajs/ava">ava</a></h2>

<p>首先配置基本参数：</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="err">//</span><span class="w"> </span><span class="err">package.json</span><span class="w">

</span><span class="s2">"ava"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"concurrency"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"failFast"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"files"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"test/*.test.js"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"require"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"babel-register"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>使用方法也很简单：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="kr">import</span> <span class="nx">test</span> <span class="nx">from</span> <span class="s1">'ava'</span><span class="p">;</span>
<span class="nx">test</span><span class="p">(</span><span class="s1">'it should run successfully'</span><span class="p">,</span> <span class="nx">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="p">{</span><span class="nx">stats</span><span class="p">,</span> <span class="nx">errors</span><span class="p">}</span> <span class="o">=</span> <span class="nx">webpackBuildStats</span><span class="p">;</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">falsy</span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">hasWarnings</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">hasWarnings</span><span class="p">());</span>
<span class="p">});</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>运行时除了会输出测试用例结果，还会输出一张代码覆盖率表格，并标出未覆盖的代码行号。
测试代码覆盖率其实很有用，出现很低的覆盖率要么是代码本身问题，要么是测试用例覆盖不全。</p>

<p><img src="/img/ava-log.png" alt="" /></p>

<h2 id="travis-ci">travis ci</h2>

<p>使用持续集成工具，每次提交时自动运行测试脚本。</p>

<p>首先需要有项目的owner权限，授权给travis。</p>

<p>然后在配置文件中我们可以：</p>
<ul>
  <li>设置多个 Node.js 版本环境</li>
  <li>提供安装依赖和脚本，这里就直接运行测试命令了</li>
</ul>

<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="s">//.travis.yml</span>

<span class="s">language</span><span class="pi">:</span> <span class="s">node_js</span>
<span class="s">node_js</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">4"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">5"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">6"</span>
<span class="s">install</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">npm install</span>
<span class="s">script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">npm test</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>完成后就可以在<code class="highlighter-rouge">README.md</code>里加上build图标了。<img src="https://travis-ci.org/lavas-project/vue-skeleton-webpack-plugin.svg?branch=master" alt="" /></p>

    </div>
</article>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.post-heading h2').remove('.subheading').remove('#logo');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -1.25em;
            font-size: 1.1em;
        }
    }
</style>
            </div>
        </div>

        <script src="/js/jquery.scrollzer.min.js"></script>
<script src="/js/jquery.scrolly.min.js"></script>
<script src="/js/skel.min.js"></script>
<script src="/js/skel-layers.min.js"></script>
<script src="/js/init.js"></script>


    </body>

</html>
