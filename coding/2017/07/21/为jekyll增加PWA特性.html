<!DOCTYPE html>
<html>

    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="coding编程javascriptxiaoiverxiaop">
    <meta name="theme-color" content="#eee">
    <!-- Begin Jekyll SEO tag v2.2.3 -->
<title>为jekyll增加PWA特性 | xiaOp的博客</title>
<meta property="og:title" content="为jekyll增加PWA特性" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="背景" />
<meta property="og:description" content="背景" />
<link rel="canonical" href="https://xiaoiver.github.io/coding/2017/07/21/%E4%B8%BAjekyll%E5%A2%9E%E5%8A%A0PWA%E7%89%B9%E6%80%A7.html" />
<meta property="og:url" content="https://xiaoiver.github.io/coding/2017/07/21/%E4%B8%BAjekyll%E5%A2%9E%E5%8A%A0PWA%E7%89%B9%E6%80%A7.html" />
<meta property="og:site_name" content="xiaOp的博客" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-07-22T03:21:32+08:00" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"为jekyll增加PWA特性","datePublished":"2017-07-22T03:21:32+08:00","dateModified":"2017-07-22T03:21:32+08:00","description":"背景","mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaoiver.github.io/coding/2017/07/21/%E4%B8%BAjekyll%E5%A2%9E%E5%8A%A0PWA%E7%89%B9%E6%80%A7.html"},"url":"https://xiaoiver.github.io/coding/2017/07/21/%E4%B8%BAjekyll%E5%A2%9E%E5%8A%A0PWA%E7%89%B9%E6%80%A7.html"}</script>
<!-- End Jekyll SEO tag -->

    <title>为jekyll增加PWA特性</title>

    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="canonical" href="https://xiaoiver.github.io/coding/2017/07/21/%E4%B8%BAjekyll%E5%A2%9E%E5%8A%A0PWA%E7%89%B9%E6%80%A7.html">
    <link rel="manifest" href="/manifest.json">

    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-large.css" />
    <link rel="stylesheet" href="/css/highlight.css" />
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/Imager.min.js"></script>

</head>


    <body>

        <section id="header" class="skel-layers-fixed">
    <header>
        <span class="image avatar"><img src="/img/avatar.jpg" alt="" /></span>
        <h1 id="logo"><a href="/">xiaOp</a></h1>
        <p>想成为一个有趣的人</p>
    </header>
    <nav id="nav">
        <ul>
            <li><a href="#intro">主页</a></li>
            <li><a href="#blog">文章</a></li>
            <li><a href="#contact">兴趣</a></li>
        </ul>
    </nav>
    <footer>
        <ul class="icons">
            <li><a href="https://github.com/xiaoiver" class="icon fa-github"><span class="label">Github</span></a></li>
            <li><a href="mailto:pyqiverson@gmail.com" class="icon fa-envelope"><span class="label">Email</span></a></li>
            <li><a href="https://www.douban.com/people/150275082/" class="icon">豆</a></li>
            <li><a href="https://www.zhihu.com/people/pan-yu-qi-20/activities" class="icon">知</a></li>
        </ul>
    </footer>
</section>


        <div id="wrapper">
            <div id="main">
                <style type="text/css">
    header.intro-header {
        position: relative;
        background-image: url('/img/post-bg-js-module.jpg')
    }
    

    .post-heading {
        position: relative;
        padding: 50px 0;
        color: white;
    }
    .post-heading h2,
    .post-heading h3,
    .post-heading h4 {
        color: white;
    }
    .post-heading h2 {
        font-size: 3em;
    }

    article {
        padding-top: 20px;
    }

    .post-container img {
        display: block;
        max-width: 100%;
        height: auto;
        margin: 1.5em auto 1.6em auto;
    }
    .post-container a {
        color: #4acaa8;
    }
</style>

<header class="intro-header" >
    <div class="header-mask"></div>
    <div class="container">
        <div class="post-heading">
            <h2>为jekyll增加PWA特性</h1>
            <h3 class="subheading"></h2>
            <div class="tags">
                
                <a class="tag" href="/tags#ruby" title="ruby">ruby</a>
                
                <a class="tag" href="/tags#jekyll" title="jekyll">jekyll</a>
                
            </div>
            <span class="meta">Posted by xiaOp的博客 on July 21, 2017</span>
        </div>
    </div>
</header>

<article class="post-container">
    <div class="container">
        <h2 id="背景">背景</h2>

<p>试图为 jekyll 增加 PWA 特性支持，顺便整理了下自己之前放在 github 上的博客。</p>

<h2 id="bundler">bundler</h2>

<p>我们都知道 ruby 中安装依赖的工具是 gem，类似 Node.js 中的 npm。但不同之处在于，gem 的依赖是全局性的，并没有项目內的<code class="highlighter-rouge">node_modules</code>，而且 gem 并没有类似 package.json 这样的依赖描述文件，这就导致安装特定版本号的依赖很不方便。</p>

<p>而 bundler 提供了缺失的依赖管理功能，正如自身的介绍“一个管理 gem 的 gem”。主要依靠两个描述文件：</p>
<ul>
  <li><code class="highlighter-rouge">Gemfile</code>类似<code class="highlighter-rouge">package.json</code>，包含依赖列表，版本要求等。</li>
  <li>安装所有依赖后会生成<code class="highlighter-rouge">Gemfile.lock</code>，类似 yarn 中的<code class="highlighter-rouge">yarn.lock</code>，存储依赖的精确版本。</li>
</ul>

<p>这样将这两个文件连同项目一并提交，就能保证代码共享后依赖的一致性。</p>

<p>首先使用 gem 安装，然后创建<code class="highlighter-rouge">Gemfile</code>文件，写入依赖并安装：</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">gem install bundler
bundle init
<span class="nb">echo</span> <span class="s1">'gem "rspec"'</span> &gt;&gt; Gemfile
bundle install
bundle <span class="nb">exec </span>rspec</code></pre></figure>

<p>命令都和 npm 一样，不知道是否有借鉴。</p>

<h2 id="github-pages">Github Pages</h2>

<p><a href="https://pages.github.com/">Github Pages</a>帮助托管 jekyll 项目，我们只需要将代码提交到指定分支(master/gh-pages)，github 将自动完成构建。但是和在本地构建不同的是，github 构建时会加上<code class="highlighter-rouge">--save</code>参数，只运行<a href="https://pages.github.com/versions/">信任的插件</a>。所以如果使用了其他插件，例如用户自定义的插件，就只能在本地构建后，提交<code class="highlighter-rouge">_sites</code>文件夹的内容了。</p>

<p>需要注意的是 Github Pages 目前仅支持到 jekyll 3.4.5 版本，而我本地安装的最新版 jekyll 是 3.5.0 版本的。新版本在<code class="highlighter-rouge">_config.yml</code>中使用<code class="highlighter-rouge">plugins</code>代替旧版本的属性<code class="highlighter-rouge">gems</code>，所以为了兼容 Github Pages，本地的警告提示信息只能忽略了。</p>

<p>另外，在安装<code class="highlighter-rouge">github-pages</code>时，我遇到了这样一个报错。
<code class="highlighter-rouge">bundle config build.nokogiri -v '1.8.0' --with-iconv-lib=/usr/local/lib --with-iconv-include=/usr/local/include</code></p>

<h2 id="已有的支持-pwa-模版">已有的支持 PWA 模版</h2>

<p>我找到了一个基于 yeoman 的<a href="https://github.com/nirgn975/generator-jekyll-starter-kit">模版</a>，包含了对 PWA 的支持。这个模版在构建时使用 gulp 通过 sw-precache 生成<code class="highlighter-rouge">service-worker.js</code>。缓存<code class="highlighter-rouge">_site</code>文件夹内全部静态资源。同时定义了其他 task，包括使用 jekyll build 文章列表。所以使用这个模版之后，其实构建就完全使用 gulp 工作流了。</p>

<h2 id="后续思路">后续思路</h2>

<p>所以我也打算以模版而非插件形式提供支持，参考 pjax 思路，使用 ajax 请求页面，替换内容，同时配合 sw-toolbox 缓存异步请求。</p>


    </div>
</article>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.post-heading h2').remove('.subheading').remove('#logo');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -1.25em;
            font-size: 1.1em;
        }
    }
</style>
            </div>
        </div>

        <script src="/js/jquery.scrollzer.min.js"></script>
<script src="/js/jquery.scrolly.min.js"></script>
<script src="/js/skel.min.js"></script>
<script src="/js/skel-layers.min.js"></script>
<script src="/js/init.js"></script>


    </body>

</html>
