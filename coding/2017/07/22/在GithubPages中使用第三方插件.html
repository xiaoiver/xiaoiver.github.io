<!DOCTYPE html><meta charset=utf-8><meta name=viewport content="width=device-widthinitial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=keywords content=coding编程javascriptxiaoiverxiaop><meta name=theme-color content=#eee><title>在Github Pages中使用第三方插件 | xiaOp的博客</title><meta property=og:title content="在Github Pages中使用第三方插件"><meta name=author content=xiaOp><meta property=og:locale content=en_US><meta name=description content="Github Pages能够帮助我们托管 jekyll 项目，我们只需要将代码提交到指定分支(master/gh-pages)，github 将自动完成构建。"><meta property=og:description content="Github Pages能够帮助我们托管 jekyll 项目，我们只需要将代码提交到指定分支(master/gh-pages)，github 将自动完成构建。"><link rel=canonical href=https://xiaoiver.github.io/coding/2017/07/22/%E5%9C%A8GithubPages%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6.html><meta property=og:url content=https://xiaoiver.github.io/coding/2017/07/22/%E5%9C%A8GithubPages%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6.html><meta property=og:site_name content=xiaOp的博客><meta property=og:type content=article><meta property=article:published_time content=2017-07-23T03:21:32+08:00><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"在Github Pages中使用第三方插件","author":{"@type":"Person","name":"xiaOp"},"datePublished":"2017-07-23T03:21:32+08:00","dateModified":"2017-07-23T03:21:32+08:00","description":"Github Pages能够帮助我们托管 jekyll 项目，我们只需要将代码提交到指定分支(master/gh-pages)，github 将自动完成构建。","mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaoiver.github.io/coding/2017/07/22/%E5%9C%A8GithubPages%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6.html"},"url":"https://xiaoiver.github.io/coding/2017/07/22/%E5%9C%A8GithubPages%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6.html"}</script><title>在Github Pages中使用第三方插件</title><link rel="shortcut icon" href=/img/favicon.ico><link rel=canonical href=https://xiaoiver.github.io/coding/2017/07/22/%E5%9C%A8GithubPages%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6.html><link rel=manifest href=/manifest.json><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/style-large.css><link rel=stylesheet href=/css/prism.css><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]--><script src=/js/jquery.min.js></script><script src=/js/Imager.min.js></script><script src=/js/jquery.scrollzer.min.js></script><script src=/js/jquery.scrolly.min.js></script><script src=/js/skel.min.js></script><script src=/js/skel-layers.min.js></script><script src=/js/prism.min.js></script><script src=/js/init.min.js></script><section id=header class=skel-layers-fixed><header><span class="image avatar"><img src=/img/avatar.jpg alt=""></span><h1 id=logo><a href=/ class=secret>xiaOp's Blog</a></h1><p>想成为一个有趣的人</header><nav id=nav><ul><li><a href=#intro>主页</a><li><a href=#blog>文章</a><li><a href=#contact>兴趣</a></ul></nav><footer><ul class=icons><li><a href=https://github.com/xiaoiver class="icon fa-github"><span class=label>Github</span></a><li><a href=mailto:pyqiverson@gmail.com class="icon fa-envelope"><span class=label>Email</span></a><li><a href=https://www.douban.com/people/150275082/ class=icon>豆</a><li><a href=https://www.zhihu.com/people/pan-yu-qi-20/activities class=icon>知</a></ul></footer></section><div id=wrapper><div id=main><style>header.intro-header {
        position: relative;
        background-image: url('/img/post-bg-js-module.jpg');
        background-size: cover;
    }
    

    header.intro-header .icon {
        position: absolute;
        top: 8px;
        right: 8px;
        color: white;
        background: #4acaa8;
        border-radius: 50%;
        height: 2.5em;
        width: 2.5em;
        line-height: 2.5em;
        text-align: center;
    }

    .post-heading {
        position: relative;
        padding: 50px 0;
        color: white;
    }
    .post-heading h2,
    .post-heading h3,
    .post-heading h4 {
        color: white;
    }
    .post-heading h2 {
        font-size: 3em;
    }
    .post-heading .meta {
        transform: translate(0.1em, 0.5em);
    }

    article {
        padding-top: 20px;
    }

    .post-container img {
        display: block;
        max-width: 100%;
        height: auto;
        margin: 1.5em auto 1.6em auto;
    }
    .post-container a {
        color: #4acaa8;
    }</style><header class=intro-header><div class=header-mask></div><span class="icon fa-code"></span><div class=container><div class=post-heading><h2>在Github Pages中使用第三方插件<h3 class=subheading>仅对本地构建结果进行版本控制</h3></h2><div class=tags><a class=tag href=/tags#ruby title=ruby>ruby</a> <a class=tag href=/tags#jekyll title=jekyll>jekyll</a> <a class=tag href=/tags#github-pages title=github-pages>github-pages</a></div><span class="meta secret secret-lg">Posted by xiaOp on July 22, 2017</span></div></div></header><article class=post-container><div class=container><p><a href=https://pages.github.com/ >Github Pages</a>能够帮助我们托管 jekyll 项目，我们只需要将代码提交到指定分支(master/gh-pages)，github 将自动完成构建。<p>jekyll 项目不可避免的会使用各种各样的插件，而 Github Pages 目前仅支持到 jekyll 3.4.5 版本，新版本在<code class=highlighter-rouge>_config.yml</code>中对插件的使用方法发生了变更，使用<code class=highlighter-rouge>plugins</code>代替旧版本的属性<code class=highlighter-rouge>gems</code>。所以为了兼容 Github Pages，本地新版本的警告提示信息只能选择忽略了。<p>和在本地构建不同的一点是，github 构建时会加上<code class=highlighter-rouge>--save</code>参数，只运行<a href=https://pages.github.com/versions/ >信任的插件</a>。这就导致如果我们的博客使用了不在白名单中的插件，github 构建时就会提示警告（在项目标签页 Setting -&gt; GitHub Pages 中），构建失败也就看不到最新的博客内容了。<p>Github Pages 给出一种建议是，让用户在本地构建站点，然后仅将构建结果纳入版本控制，提交到指定分支。避免 github 构建，只需要在根目录下放一个空文件<code class=highlighter-rouge>.nojekyll</code>。<p>至于本地构建，熟悉 Node.js 的开发者完全可以采用 gulp/grunt 工作流，调用<code class=highlighter-rouge>jekyll build</code>构建站点，顺便还能做一些静态资源压缩的工作。我在网上找到一种使用 rakefile 的<a href=https://www.sitepoint.com/jekyll-plugins-github/ >简单方法</a>，决定一试。<h2 id=使用-rakefile-构建>使用 Rakefile 构建</h2><p>首先我们需要拷贝原有 repo 内容到一个新文件夹中，以后这个新文件夹将成为我们的工作文件夹。由于以后我们不会再在原有 repo 中进行写作，所以此时可以在 repo 中执行<code class=highlighter-rouge>git rm -r ./</code>清空所有版本控制。<p>在新文件夹中增加 Rakefile，进行如下操作：<ol><li>使用<code class=highlighter-rouge>jekyll build</code>构建站点<li>清空真正的 repo 内容，拷贝<code class=highlighter-rouge>_site</code>文件夹内容到里面。</ol><div><pre class=line-numbers data-line=""><code class=language-ruby>GH_PAGES_DIR = &quot;xiaoiver.github.io&quot;

desc &quot;Build Jekyll site and copy files&quot;
task :build do
  system &quot;jekyll build&quot;
  system &quot;rm -r ../#{GH_PAGES_DIR}/*&quot; unless Dir[&#39;../#{GH_PAGES_DIR}/*&#39;].empty?
  system &quot;cp -r _site/* ../#{GH_PAGES_DIR}/&quot;
end</code></pre></div><p>Rakefile 只在构建时使用，所以需要在<code class=highlighter-rouge>_config.yml</code>中过滤掉，避免拷贝到结果文件夹中：<div><pre class=line-numbers data-line=""><code class=language-yml>exclude: [Rakefile]</code></pre></div><p>然后回到 repo 中，提交修改即可。<h2 id=使用-gulp-工作流构建>使用 gulp 工作流构建</h2><p>例如这个基于 yeoman 的<a href=https://github.com/nirgn975/generator-jekyll-starter-kit>模版项目</a>，包含了对 PWA 的支持。<p>这个模版在构建时使用 gulp 通过 sw-precache 生成<code class=highlighter-rouge>service-worker.js</code>，缓存<code class=highlighter-rouge>_site</code>文件夹内全部静态资源。同时也定义了其他 task 用于压缩静态文件。<p>我在博客中也使用了这种方式。</div></article><script>function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }</script><script>async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.post-heading h2').remove('.subheading').remove('#logo');
    })</script><style>/* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -1.25em;
            font-size: 1.1em;
        }
    }</style></div></div>